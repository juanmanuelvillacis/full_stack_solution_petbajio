<!DOCTYPE html>
<html>
  <head>
    <style>
      #loaderImpresion {
      position: fixed;
      top: 80%;
      left: 50%;
      transform: translate(-50%, -50%);
      }
    </style>
    <base target="_top">
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdn.metroui.org.ua/current/metro.css">
    <!-- Icons -->                    
    <link rel="stylesheet" href="https://cdn.metroui.org.ua/current/icons.css">
    
  </head>
  <body>
    <div class="container">
      <div class="d-flex flex-justify-center">
      <button id="printAll" class="button shadowed mr-3"><span class="mif-print">Validados</span></button>
      <button id="printSelected" class="button shadowed"><span class="mif-print">Seleccionados</span></button>
      </div>
      <div style="margin: 10px 0;"></div>
      <div id="loader" class="no-visible">
        <div data-role="progress" data-type="line"></div>
        <div data-role="progress" data-type="line" data-small="true"></div>
      </div>
      

      <table id="foliosToPrint" class="table striped table-border mt-4"
        data-role="table"
        data-rows="10"
        data-rows-steps="5, 10,20"
        data-show-activity="false"
        data-rownum="true"
        data-check="true"
        data-check-style="2">
        <thead>
        <tr>
          <th data-sortable="true" data-sort-dir="asc">Folio</th>
          <th data-sortable="true" data-sort-dir="desc">Fecha</th>
          <th data-sortable="true" data-sort-dir="asc">Veterinaria/MVZ</th>
          <th data-sortable="true" data-sort-dir="asc">Mascota</th>

        </tr>
        </thead>
        <tbody>
        
        </tbody>
      </table>
    </div>

    <script src="https://cdn.metroui.org.ua/current/metro.js"></script>
     <script>
      const FoliosPrintApp = {}
      FoliosPrintApp.loader = document.getElementById("loader")
      FoliosPrintApp.afterSideBarLoads = function(){
        FoliosPrintApp.loader.classList.remove("no-visible")
        FoliosPrintApp.foliosToPrintTable = Metro.getPlugin("#foliosToPrint","table")
        //FoliosPrintApp.loadFolioInfoToTable
        google.script.run.withSuccessHandler(loadTableSideBar => {
          FoliosPrintApp.foliosToPrintTable.setItems(loadTableSideBar)
          FoliosPrintApp.foliosToPrintTable.reload()
          FoliosPrintApp.loader.classList.add("no-visible")
        }).getCertInfoFolio()
      } //afterSideBarLoads

      /*FoliosPrintApp.loadFolioInfoToTable = function(){
        google.script.run.withSuccessHandler(loadTableSideBar => {
          FoliosPrintApp.foliosToPrintTable.setItems(loadTableSideBar)
          FoliosPrintApp.foliosToPrintTable.reload()
          FoliosPrintApp.loader.classList.add("no-visible")
        }).getCertInfoFolio()
      }//loadFolioInfoToTable*/
      FoliosPrintApp.printAll = function(){
        FoliosPrintApp.loader.classList.remove("no-visible")
        google.script.run.withSuccessHandler(loadTableSideBar => {
          FoliosPrintApp.loader.classList.add("no-visible")
        }).triggerCertificatesElaboration()
      }//printAll

      FoliosPrintApp.printSelected = function(){
        var selectedFolios = FoliosPrintApp.foliosToPrintTable.getSelectedItems().map(r => r[0])
        if (selectedFolios.length == 0){
          FoliosPrintApp.loader.classList.add("no-visible")
          window.alert("Seleccione algÃºn folio a ser impreso");
          return
        }
        const selectedFoliosString = JSON.stringify(selectedFolios)
        FoliosPrintApp.loader.classList.remove("no-visible")
        google.script.run.withSuccessHandler(result => {
          //FoliosPrintApp.loadFolioInfoToTable
          FoliosPrintApp.foliosToPrintTable.clearSelected()
          FoliosPrintApp.foliosToPrintTable.removeFilters()
          FoliosPrintApp.foliosToPrintTable.reload()
          FoliosPrintApp.loader.classList.add("no-visible")
        }).triggerCertificatesElaboration(selectedFoliosString)
      }//printSelected
      document.addEventListener("DOMContentLoaded",FoliosPrintApp.afterSideBarLoads)
      document.getElementById("printAll").addEventListener("click",FoliosPrintApp.printAll)
      document.getElementById("printSelected").addEventListener("click",FoliosPrintApp.printSelected)

    </script>

  </body>
</html>
