<script>
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById("btn").addEventListener("click",selectFoliosToModify);
        google.script.run.withSuccessHandler(getFolios).getFoliosFromSheets("ws_info");
        google.script.run.withSuccessHandler(populateRecolectoresOptionsSelect).getRecolectores()
        document.getElementById("btnFiltro").addEventListener("click",filtar);
        
      });
      function filtar (){
        google.script.run.seeModifiedProspectador();
      }

      function populateRecolectoresOptionsSelect(recolectores){
        var selElement = document.getElementById("prospectadorNuevo")
        for (var i = 0; i < recolectores.length; i++) {
          var options = document.createElement("option");
          options.text = recolectores[i]
          options.value = recolectores[i]
          selElement.appendChild(options)
        }
        M.FormSelect.init(selElement)
      }
      function selectFoliosToModify () {
        startLoader("loaderModProsp")
        var chipsFolios = document.getElementById('chips');
        var instance = M.Chips.getInstance(chipsFolios);
        var prodObject = instance.chipsData;
        if(Object.keys(prodObject).length==0){
          window.alert("Seleccione algún folio a ser modificado");
        }
        var folioList = []
        var prodObject = instance.chipsData;
        for (var x=0; x < Object.keys(prodObject).length; x++){
          folioList.push(prodObject[x]["tag"])
        }
        var nuevoProspect = document.getElementById("prospectadorNuevo").value;
        let userResponse = confirm('El nuevo prospectador para '+ String(Object.keys(prodObject).length)+" folios será "+ nuevoProspect+" estás seguro que deseas continuar?");
        if (userResponse) {
            google.script.run.withSuccessHandler(cleanSidebar).modifyProspectador(folioList,nuevoProspect);
        } else {
            return
        }
      }
      function cleanSidebar (){
        stopLoader("loaderModProsp")
        var chips = document.getElementById("chips")
        var instance = M.Chips.getInstance(chips);
        var prodObject = instance.chipsData;
        for (let x=0; x <= Object.keys(prodObject).length+1; x++){
          instance.deleteChip(0)
        }
        M.toast({html: 'Modificación Exitosa!'})
      }
      function getFolios(foliosString) {
        if (foliosString == 0){return}
        var chipsFolios = document.getElementById('chips');
        M.Chips.init(chipsFolios, {
          placeholder: 'Buscar Folio(s)',
          secondaryPlaceholder: '+Folio',
          autocompleteOptions: {
            data: JSON.parse(foliosString),
            limit: Infinity,
            minLength: 1
          }
        });
      }
      function startLoader(loaderType){
        var preloader = document.getElementById(loaderType);
        preloader.style.display = 'block';
      }

      function stopLoader(loaderType){
        var preloader = document.getElementById(loaderType);
        setTimeout(function() {
        preloader.style.display = 'none'; // Hide preloader
        }, 200);
      }
    </script>